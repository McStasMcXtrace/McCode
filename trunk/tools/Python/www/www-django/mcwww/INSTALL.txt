# ================================================ #
*  Install - McStas and the (optional) Webserver   *
*  ---------------------------------------------   *
*        Debian 7.1 iso 64bit (DL+install)         *
*         use ifconfig to find ip address          *
# ================================================ #

System Setup
------------

1) Check out the McCode SVN repos:
     mkdir <whatever_build_dir_structure_you_want>
     cd <whatever_build_dir_structure_you_want>
     svn co https://svn.mccode.org/svn/McCode/trunk

2) Build all dependencies in this list:
     sudo apt-get (build-dep) install  cmake
     	  	  	      	       texlive-* (all except the langs and docs, you just need lang-danish)
				       latex2html
				       latexmk
				       gcc
				       flex
				       bison
				       libc6-dev
     	  	  	      	       xbase-clients 
                                       build-essential 
				       emacs 
				       subversion 
				       nginx-full 
				       python-django
				       libopenmpi-dev (if you need MPI. (Yes, you need it.))

3) Enable non-free repos:
      sudo apt-add-repository 'deb http://ftp.debian.org/debian/ wheezy main contrib non-free'
      cd /etc/apt/sources.list.d
      sudo wget http://packages.mccode.org/debian/mccode.list
   change your shell to bash:
      dpkg-reconfigure dash (and tell it 'No')
   now look at all the goodies you have directed your machine to find:
      sudo apt-get update ; apt-get upgrade

4) In the trunk dir there are a bunch of scripts which build .debs or .rpms for your particular
   OS. Run the correct one.
      cd /trunk/dist
      dpkg -fi <whichever_you_wish_to_install> (I would just install them all)
   The -f flag tells the unmet dependencies to be forced to install.


Setting up Django Webserver
---------------------------

5) Create the server dir and copy the server files into it, you are playing in the root dir now so you have to 
   sudo everything or run as root, change the permissions at the end if you don't like running round your 
   system as su:
     sudo mkdir /srv/mcstas-django
     sudo cp -rp /root/trunk/tools/Python/www/www-django/mcwww/ /srv/mcstas-django

6) Move to your shiny new working directory (the one you just made). Run:
     sudo bin/get-dependencies.sh

7) Populate sim/ with at least one instr - 
     sudo cp /usr/local/lib/mcstas-2.0/examples/PSI_DMC.instr sim

side note: Ensure your keyboard is set to a locale that the python scripts are happy with:
     export LC_ALL="en_US.UTF-8"  

8) Run:
     sudo ./bin/init-db.sh

9) Follow the prompts, you should set up a superuser to start with, step 10a shows how to create new users:

   Username (leave blank to use 'root'): 
   E-mail address:
   Password: 
   Password (again): 
   Superuser created successfully.

10) Run the following commands (put the runworker in the background with '&' or open a new terminal):
   a)  sudo ./manage.py createuser <USERNAME> <PASSWORD>
   b)  sudo ./bin/update-simulations.sh ; ./manage.py populate_db
   c)  sudo ./manage.py runworker &
   d)  sudo ./manage.py runserver <IP ADDRESS>:<PORT> (80 is a good listening port)



