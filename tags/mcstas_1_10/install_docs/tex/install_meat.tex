\label{s:install}

\section{Getting McStas}
\label{s:obtain}
The \htmladdnormallink{McStas}{http://www.mcstas.org} package is
available in various distribution packages, from the project
website at
\htmladdnormallink{http://www.mcstas.org/download}{http://www.mcstas.org/download}.
\begin{itemize}
\item{\texttt{McStas-1.10-i686-Win32.exe}\\Preferred Windows
    installation method: self-extracting executable
    including essential support tools. - Refer to section
    \ref{s:win32_install}. \\\ \\(If you prefer the old \verb+build.bat/install.bat+
    procedure for Windows, you should instead download the alternative
    \\\texttt{mcstas-1.10-i686-unknown-Win32.zip} package. \\Please note that
    the \verb+.exe+ method is clearly recommended.)}
\item{\texttt{mcstas-1.10-i686-unknown-Linux.tar.gz}\\Binary package
  for Linux systems, currently built on Ubuntu 6.06 'Dapper Drake'.
  Should work on most Linux setups.
 - Refer to section \ref{s:unix_install}}
\item{\texttt{mcstas-1.10-src.tar.gz}\\Source code package for
    building \htmladdnormallink{McStas}{http://www.mcstas.org} on
    (at least) Linux and Windows XP. This package should compile on
    most Unix platforms with an \texttt{ANSI-c} compiler. - Refer to section \ref{s:unix_install}}
\end{itemize}

\section{Licensing}
The conditions on the use of McStas can be read in the files
\verb+LICENSE+ and \verb+LICENSE.LIB+ in the distribution. Essentially,
McStas may be used and modified freely, and copies of the McStas source code
may be distributed to others.
New or modified component and instrument files may be shared by
the user community, and the core team will be happy to include user contributions in the package.

\section{Installation on windows}
\label{s:win32_install}
As of release 1.10 of McStas, the preferred way to install on
Microsoft Windows is using a self-extracting \texttt{.exe} file.

\noindent The archive includes all software needed to run McStas, including perl, a
c-compiler, a vrml viewer and Scilab for data plotting.

\noindent Installation of all the provided support tools is needed to get a fully
functional McStas. The option not to install some of the tools is only
included for people who have one or more tools installed already.

\noindent The safe and fully tested configuration/installation is to install all
tools, leaving all installation defaults untouched. Specifically you
may experience problems if you install to non-standard locations.

\noindent Simply follow the guidance given by the installer, pressing 'next' all
the way.

\noindent If you experience any problems, or have some questions or ideas
concerning McStas, please contact
\htmladdnormallink{peter.willendup@risoe.dk}{mailto:peter.willendup@risoe.dk}
or the McStas mailing list at \htmladdnormallink{neutron-mc@risoe.dk}{mailto:neutron-mc@risoe.dk}.


\section{Installation on Unix systems}
\label{s:unix_install}
Our current reference Unix class platform is
\htmladdnormallink{Ubuntu Linux}{http://www.ubuntu.com}, which is
based on \htmladdnormallink{Debian
  GNU/Linux}{http://www.debian.org}. Some testing is done on other
Unix variants, including \htmladdnormallink{Fedora
  Core}{http://fedora.redhat.com},
\htmladdnormallink{SuSE}{http://www.novell.com/products/suselinux/}
and \htmladdnormallink{FreeBSD}{http://www.freebsd.org}.


\noindent To get a fully functional McStas installation on Unix systems, a few support
applications are required. Essentially, you will need a C compiler,
Perl and Perl-Tk, as well as a plotter such as Matlab, Scilab or
PGPLOT. In the installer package, we supply a method to install PGPLOT
and related perl modules - see step \ref{pg_install} below and also
a method to download and install Scilab for Linux/Intel - see step \ref{sci_install}

\noindent On Debian and Ubuntu systems, the
needed packages to install are \texttt{perl-tk, pdl, gcc,
  libc6-dev} \\(On Ubuntu you need to enable the 'universe' package
distribution in the file \\\verb+/etc/apt/sources.list+.)

\noindent We also recommend to install octaga vrml viewer from
\\\htmladdnormallink{http://www.octaga.com/download\_octaga.html}{http://www.octaga.com/download_octaga.html}.

\subsection{Configuration and installation}
McStas uses autoconf to detect the system configuration and creates the
proper Makefiles needed for compilation. On Unix-like systems, you
should be able to compile and/or install McStas using the following steps:
\begin{enumerate}
\item{Unpack the sources to somewhere convenient and change to the
    source directory:\\
  \texttt{gunzip -c <package>.tar.gz | tar xf -}\\
  \texttt{cd mcstas-1.10/}}
\item{Configure McStas:\\
  \texttt{./configure}}
\item{Build McStas (only in case of the \verb+mcstas-1.10-src.tar.gz+ package):\\
  \texttt{make}}
\item{Optionally build/install PGPLOT (as superuser - build
    dependencies are pdl, g77, libx11-dev, xserver-xorg-dev, libxt-dev
    on Ubuntu):\\
    \texttt{make install-pgplot \&\& ./configure}
    \label{pg_install}}
\item{Optionally download/install Scilab (as superuser - only on Linux
    with Intel hardware):\\
    \texttt{make install-scilab \&\& ./configure}
    \label{sci_install}}
\item{Install McStas (as superuser):\\
  \texttt{make install}
\label{makeinst}}
\end{enumerate}



\noindent The installation of McStas in step \ref{makeinst} by default installs in the
\texttt{/usr/local/} directory, which on most systems requires superuser (root)
privileges.

\subsection{Specifying non-standard options}
To install in a different location than \texttt{/usr/local}, use the --prefix= option to
configure in step 2. For example,\\

  ./configure --prefix=/home/joe\\

\noindent will install the McStas programs in /home/joe/bin/ and the
library files needed by McStas in /home/joe/lib/mcstas/.

In case ./configure makes an incorrect guess, some environment variables
can be set to override the defaults:
\begin{itemize}
\item{The CC environment variable may be set to the name of the C compiler
   to use (this must be an ANSI C compiler). This will also be used for
   the automatic compilation of McStas simulations in mcgui and
   mcrun.}
\item{CFLAGS may be set to any options needed by the compiler (eg. for
   optimization or ANSI C conformance). Also used by mcgui/mcrun.}
\item{PERL may be set to the path of the Perl interpreter to use.}
\end{itemize}
\noindent To use these options, set the variables before running ./configure. Eg.\\

    setenv PERL /pub/bin/perl5

    ./configure\\

\noindent It may be necessary to remove configure's cache of old
choices first:\\


    rm -f config.cache\\


\noindent If you experience any problems, or have some questions or ideas
concerning McStas, please contact
\htmladdnormallink{peter.willendup@risoe.dk}{mailto:peter.willendup@risoe.dk}
or the McStas mailing list at \htmladdnormallink{neutron-mc@risoe.dk}{mailto:peter.willendup@risoe.dk}.

\section{Finishing and Testing the McStas distribution}
\label{s:testing}

Once installed, you may check and tune the guessed configuration stored within file
\begin{itemize}
\item{\verb+MCSTAS\tools\perl\mcstas_config.perl+ on Windows systems}
\item{\verb+MCSTAS/tools/perl/mcstas_config.perl+ on Unix/Linux systems}
\end{itemize}
where \verb+MCSTAS+ is the location for the McStas library.

You may, on Linux systems, ask for a reconfiguration (e.g. after installing MPI, Matlab, ...) with the commands, e.g:
\begin{verbatim}
cd MCSTAS/tools/perl/
sudo ./mcstas_reconfigure
\end{verbatim}
On Windows systems, the reconfiguration is performed with the \verb+mcconfig.pl+ command.

The \verb+examples+ directory of the distribution contains a set of instrument examples. These are used for the McStas self test procedure, which is executed with
\begin{verbatim}
    mcrun --test # mcrun.pl on Windows
\end{verbatim}
This test takes a few minutes to complete, and ends with a short report on the installation itself, the simulation accuracy and the plotter check.

You should now be able to use McStas. For some examples to try, see the
examples/ directory. Start 'mcgui' (mcgui.pl on Windows), and select one of the examples in the 'Neutron Sites' menu.
